当数据有更新时，如何保证 cache 和 db 的一致性？

考虑到并发的场景，目前没有哪一种策略可以保证绝对的一致性，比较好的方式是先更新 db，然后再删除缓存。考虑如下操作顺序：

| 时间 | 线程1            | 线程2               | DB   | Cache |
| ---- | ---------------- | ------------------- | ---- | ----- |
| T0   |                  |                     | x=1  |       |
| T1   | read x=1 from db |                     |      |       |
| T2   |                  | update x=2          | x=2  |       |
| T3   |                  | delete x from cache |      |       |
| T4   | put x=1 to cache |                     |      | x=1   |

还有一个问题，需要分别写db和cache，如何保证两者都成功？