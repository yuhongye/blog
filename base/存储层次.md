### 局部性原理

局部性原理：

* 时间局部性原理： 已经访问过的数据项很快会再次被访问
* 空间局部性原理：刚被访问过的数据，它邻近的数据可能马上会被访问到

这是缓存之所以有效的原因，存储层级的根本就是局部性原理：上一层极是下一层极的缓存。

# 1 存储介质

### 磁盘

磁盘有几个概念：

* 盘面： 一个硬盘是由多个盘面组成的，注意：每个盘面都有自己的读写头，这个很重要
* 磁道：一个盘面被分成了若干个同心圆，这些同心圆轨迹叫做磁道
* 扇区：每个磁道被分成若干个扇区，一个扇区一般存储512B-4KB的数据。在之前的硬盘中，每个磁道的扇区数是一样的，但是显然磁道约靠外它的半径越长，它应该拥有的扇区数应该越多。所以现在的硬盘都使用Zoned Bit Recording技术，将盘片表面由里向外划分成数个区域，每个区域内的磁道拥有相同的扇区数，不同区域内的扇区数不同，越往外扇区数越多
* 柱面：所有盘面上的同一磁道构成了一个圆柱，通常称为柱面，每个圆柱上的磁头从上而下从0开始编号。

数据的读写时按照柱面进行的，当开始读写时:

1. 磁头臂(机械地)移动到目标磁道，此时每个盘面的磁头都处在同一个磁道编号上，也就是选中了一个柱面
2. 此时只有盘面0的磁头是有效的，旋转盘面，这样磁头就会依次读取扇区上的数据，注意是旋转盘面，不是旋转磁头
3. 当盘面0读写完后通过电子切换选取盘面1的磁道，继续读取
4. 当整个柱面的所有磁道都读写完后，需要再次移动磁头臂到下一个磁道上。

由此我们可以发现在真正读取数据之前，需要做两个操作：

* 寻道时间：将磁头移动到指定的磁道，这个时间目前是3-15ms左右
* 旋转延迟：磁头移动到了指定的磁道，还需要转动盘面，将指定的扇区移动到磁头下，通常将0.5周作为旋转延迟，一个7200转/分钟的硬盘，旋转一周需要8.33ms，则旋转延迟约为4.17ms

因此我们可以看到，随机读取的情况下，每次读数据之前就会有10ms左右的延迟时间，这个也是随机读取较慢的主要原因。

### DRAM

原理是利用电容内存储电荷的多少来表示一个bit是0还是1，由于晶体管会漏电导致电容上存储的电荷数量不足以正确的识别数据，因此对于DRAM来说需要周期性的充电，由于这种需要定时刷新的特性，它被称为是Dynamic。

与SRAM相比:

* 结构简单，密度高，价格低：每个bit DRAM需要一个电容跟一个晶体管，而SRAM需要6-8个晶体管
* 速度慢，耗电大：DRAM需要周期刷新，SRAM不需要

##### DDR SDRAM(Double Date Rate Synchronous DRAM)

双倍数据传输速率的SDRAM，其数据传输速率为系统时钟脉冲的两倍，在系统时钟的上升沿和下降沿都可以进行数据传输(SDRAM在一个时钟周期内只传输一次：上升沿传输数据)，每代DDR就是提升工作频率和数据传输速率。

### SRAM

只要保持通电，里面的数据就可以一直保持，这是它被称为静态的原因，主要用于CPU Cache。



# 2 Cache

#### Cache 7个示例

来自微软大牛的博客：[http://igoro.com/archive/gallery-of-processor-cache-effects/](http://igoro.com/archive/gallery-of-processor-cache-effects/)

